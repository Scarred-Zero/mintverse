{% extends "main/partials/base_2.html" %} {% block title %} {{ title }} {%
endblock %} {% block content %} {% include
"auth/partials/_alert.html" %}

<section class="buy__wrapper" id="buy-wrapper">
  <div class="paddings innerWidth buy__container">
    <div class="buy__left">
      <div class="buy__img-container">
        <img src="{{nft.nft_image}}" alt="{{nft.nft_name}}" />
      </div>
      <div class="flexColCenter buy__des">
        <div class="accordion">
          <!-- Accordion Item -->
          <div class="accordion__item expanded">
            <!-- Initially expanded by default -->
            <button
              class="accordion__btn flexCenter"
              onclick="toggleAccordion(this)"
            >
              <div class="flexCenter icon">
                <svg
                  width="30"
                  height="30"
                  viewBox="0 0 18 18"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M2.875 14.625V14.9993C2.79666 14.8949 2.75019 14.7652 2.75 14.6247V3.37529C2.75019 3.23476 2.79666 3.10509 2.875 3.00069V3.375V14.625ZM3.3755 15.25C3.23489 15.2499 3.10514 15.2034 3.00069 15.125H3.375H14.6256H14.9993C14.8949 15.2034 14.7651 15.2499 14.6245 15.25H3.3755ZM15.25 14.6245C15.2499 14.7648 15.2036 14.8942 15.1256 14.9985L15.1256 14.625L15.125 3.37497L15.125 3.00067C15.2034 3.10512 15.2499 3.23488 15.25 3.3755V14.6245ZM14.6247 2.75C14.7652 2.75019 14.8949 2.79666 14.9993 2.875H14.625H3.375H3.00069C3.10509 2.79666 3.23476 2.75019 3.37529 2.75H14.6247ZM9.0625 12.375V12.875H9.5625H10.75V13H7.25V12.875H8.4375H8.9375V12.375V8.4375V7.9375H8.4375H7.8125V7.8125H9.0625V12.375ZM8.65625 5.53125C8.65625 5.34141 8.81016 5.1875 9 5.1875C9.18984 5.1875 9.34375 5.34141 9.34375 5.53125C9.34375 5.72109 9.18986 5.87498 9 5.87498C8.81014 5.87498 8.65625 5.72109 8.65625 5.53125Z"
                    fill="#3C4A71"
                    stroke="#2691cf"
                  ></path>
                </svg>
              </div>
              <span class="accordion__title">Token Details</span>
              <div class="flexCenter icon">
                <i class="fa fa-angle-down"></i>
              </div>
            </button>
            <div class="accordion__panel">
              <h4 class="accordion__des-title">Description</h4>
              <p class="secondaryText">{{nft.description}}</p>
              <hr />
              <h4 class="accordion__des-title royalties">
                Royalties <span>{{nft.royalties}}%</span>
              </h4>
              <hr />
              <span class="accordion__title">Details</span>
              <div class="artist__detail">
                <svg width="14" height="16" viewBox="0 0 14 16">
                  <path
                    d="M5.71393 1.83854L6.13102 2.11429L5.71393 1.83855L1.93612 7.55288L1.60592 8.05234L2.15626 8.2882L6.39258 10.1037C6.78037 10.27 7.21943 10.27 7.60723 10.1038C7.60725 10.1038 7.60728 10.1038 7.6073 10.1037L11.8436 8.2882L12.394 8.05234L12.0638 7.55288L8.28597 1.83859C8.28596 1.83858 8.28596 1.83857 8.28595 1.83855C7.67649 0.916563 6.32342 0.916648 5.71393 1.83854ZM2.71422 8.7993L1.42014 8.2447C1.44974 7.96525 1.54522 7.69087 1.70725 7.44578L5.50537 1.70067L5.50538 1.70067C6.21369 0.629238 7.78619 0.629234 8.49451 1.70067L8.49452 1.70068L12.2927 7.44577C12.2927 7.44578 12.2927 7.44578 12.2927 7.44578C12.4547 7.69088 12.5502 7.96527 12.5798 8.24472L11.2857 8.7993L7.70573 10.3335L7.70572 10.3336C7.255 10.5267 6.74488 10.5267 6.29416 10.3336L6.29415 10.3336L2.71422 8.7993ZM1.76419 9.50307C1.56787 9.23911 1.45282 8.93387 1.41999 8.62136L2.11606 9.55727L5.76291 14.4606C6.37933 15.2894 7.62055 15.2894 8.23697 14.4606L11.8839 9.55727L12.5799 8.62143C12.5471 8.93392 12.432 9.23913 12.2357 9.50306L8.43758 14.6098C8.43758 14.6098 8.43758 14.6098 8.43757 14.6098C7.72117 15.573 6.27871 15.573 5.56231 14.6098L1.76419 9.50307L1.36627 9.79902L1.76419 9.50307Z"
                    fill="white"
                    stroke="white"
                  ></path>
                </svg>
                <h1 class="artist__name">{{nft.creator}}</h1>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="artist__section">
        <h1>Artist</h1>
        <div class="artist__profile">
          <img src="/static/assets/images/profile_profile_img.jpg" alt="" />
        </div>
        <h1 class="artist__name">{{nft.creator}}</h1>
      </div>
    </div>

    <div class="buy__right">
      <div class="buy__right-con">
        <h1 class="buy__nft-name burntOrangeText">{{nft.nft_name}}</h1>

        <div class="buy__creator-and-owner-con">
          <span class="owner">
            <p class="buy__owner-label">Owner:</p>
            <p class="owner__name">{{ nft.buyer if nft.buyer else nft.creator }}</p>
            <div class="buy__owner-profile">
              <img src="/static/assets/images/profile_profile_img.jpg" alt="" />
            </div>
          </span>
          <span class="owner">
            <p class="buy__owner-label">Creator:</p>
            <p class="owner__name">{{nft.creator}}</p>
            <div class="buy__owner-profile">
              <img src="/static/assets/images/profile_profile_img.jpg" alt="" />
            </div>
          </span>
        </div>

        <div class="buy__royalties-con">
          <span class="buy__royalties-con-item">
            <svg
              width="18"
              height="18"
              viewBox="0 0 18 18"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clip-path="url(#clip0_10839_170044)">
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M10.286 1.30191C10.0409 -0.147024 7.95912 -0.147024 7.71402 1.30191C7.5384 2.3403 6.26802 2.75306 5.51555 2.01624C4.46559 0.988099 2.78143 2.21171 3.4348 3.528C3.90304 4.47132 3.11791 5.55196 2.07607 5.39813C0.622301 5.1835 -0.0209916 7.16335 1.28129 7.84423C2.21457 8.33215 2.21457 9.66787 1.28129 10.1558C-0.0209922 10.8367 0.622301 12.8165 2.07606 12.6019C3.11791 12.4481 3.90304 13.5287 3.4348 14.472C2.78143 15.7883 4.46559 17.0119 5.51555 15.9838C6.26802 15.247 7.5384 15.6597 7.71402 16.6981C7.95912 18.1471 10.0409 18.1471 10.286 16.6981C10.4617 15.6597 11.732 15.247 12.4844 15.9838C13.5344 17.0119 15.2186 15.7883 14.5652 14.472C14.097 13.5287 14.8821 12.4481 15.9239 12.6019C17.3777 12.8165 18.021 10.8367 16.7187 10.1558C15.7855 9.66787 15.7855 8.33215 16.7187 7.84423C18.021 7.16335 17.3777 5.1835 15.9239 5.39813C14.8821 5.55196 14.097 4.47132 14.5652 3.528C15.2186 2.21171 13.5344 0.988099 12.4844 2.01624C11.732 2.75306 10.4617 2.3403 10.286 1.30191ZM4.92495 8.04991C4.9448 8.04991 4.96444 8.04901 4.98383 8.04727C4.9736 8.16517 5.03307 8.36623 5.12473 8.67613L5.77531 10.876C5.81204 11.0002 5.83041 11.0623 5.87832 11.098C5.92624 11.1338 5.991 11.1338 6.12054 11.1338H8.68008H9.35274H11.9123C12.0418 11.1338 12.1066 11.1338 12.1545 11.098C12.2024 11.0623 12.2208 11.0002 12.2575 10.876L12.9081 8.67613C12.9992 8.36809 13.0585 8.16757 13.0492 8.04943C13.0579 8.04973 13.0666 8.04991 13.0753 8.04991C13.4343 8.04991 13.7253 7.75891 13.7253 7.39999C13.7253 7.04101 13.4343 6.75001 13.0753 6.75001C12.7164 6.75001 12.4254 7.04101 12.4254 7.39999C12.4254 7.65013 12.5668 7.86727 12.7739 7.97593C12.6683 8.03635 12.5293 8.14429 12.3421 8.28973L11.0016 9.33079C10.8376 9.45823 10.7555 9.52195 10.6714 9.50173C10.5872 9.48151 10.5431 9.38749 10.4549 9.19945L9.34638 6.83749C9.33264 6.80809 9.31956 6.78019 9.30702 6.75373C9.52236 6.64789 9.67062 6.42631 9.67062 6.17011C9.67062 5.81113 9.37962 5.52013 9.02064 5.52013C8.66172 5.52013 8.37072 5.81113 8.37072 6.17011C8.37072 6.42619 8.5188 6.64771 8.73408 6.75361C8.72154 6.78013 8.7084 6.80809 8.6946 6.83749L7.58394 9.20413C7.49568 9.39217 7.45158 9.48619 7.36746 9.50641C7.28334 9.52663 7.20126 9.46291 7.03722 9.33547L5.69076 8.28973C5.49387 8.13679 5.35031 8.02531 5.24286 7.96699C5.44103 7.85569 5.57491 7.64347 5.57491 7.39999C5.57491 7.04101 5.28392 6.75001 4.92495 6.75001C4.566 6.75001 4.27501 7.04101 4.27501 7.39999C4.27501 7.75891 4.566 8.04991 4.92495 8.04991ZM6.03 11.7258C5.93059 11.7258 5.85 11.8064 5.85 11.9058V12.5507C5.85 12.6501 5.93059 12.7307 6.03 12.7307H12.003C12.1024 12.7307 12.183 12.6501 12.183 12.5507V11.9058C12.183 11.8064 12.1024 11.7258 12.003 11.7258H6.03Z"
                  fill="#FFC21C"
                ></path>
              </g>
              <defs>
                <clipPath id="clip0_10839_170044">
                  <rect width="18" height="18" fill="white"></rect>
                </clipPath>
              </defs>
            </svg>
            {{nft.royalties}}% Royalties
          </span>
          <span class="buy__royalties-con-item">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="22"
              height="22"
              viewBox="0 0 24 24"
              fill="none"
              stroke="cyan"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            {{nft.views}}
          </span>
        </div>

        <div class="buy__right-con-item">
          <h3>List Price</h3>
          <h2>{{nft.price}} ETH</h2>
          <small
            >*This is the listed price for the NFT, but it doesn’t guarantee the
            seller will accept the default price purchase offer.</small
          >
        </div>
        <div class="buy__right-con-item">
          <!-- Purchase Button -->
          <button id="purchaseBtn" class="btn buy__right-con-item-btn">
            Purchase Now
          </button>

          <!-- Modal -->
          <div id="purchaseModal" class="modal">
            <div class="modal-content">
              <h3>Are you sure you want to make this purchase?</h3>
              <div class="modal-buttons">
                <form
                  id="purchaseForm"
                  method="POST"
                  action="{{ url_for('user.buy_page', ref_number=nft.ref_number) }}"
                >
                  <button
                    type="submit"
                    id="confirmPurchase"
                    class="btn btn-success"
                  >
                    Confirm
                  </button>
                </form>
                <button id="cancelPurchase" class="btn">Cancel</button>
              </div>
            </div>
          </div>
          <small
            >*Your purchase will be subject to seller approval. For the best
            chance of making it yours, we recommend using the 'Make an Offer'
            button with a great offer. Goodluck!</small
          >
        </div>
        <div class="buy__right-con-item">
          <a
            href="{{url_for('user.finalise_offer_page', ref_number=nft.ref_number)}}"
          >
            <button class="btn buy__right-con-item-btn">Make An Offer</button>
          </a>
          <small
            >*Use the 'Make an Offer' button and submit your best offer. The
            seller will be more likely to accept a competitive offer. We can’t
            wait to see you make it yours!</small
          >
        </div>
      </div>

      <div class="purchase-section_activity_offer">
        <div class="activity_offer">
          <div class="tab">
            <div class="tab_head">
              <ul>
                <li class="active">
                  <svg
                    width="15"
                    height="15"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M15.625 10.625L18.25 10.625V10.125M15.625 10.625L18.25 9.375V9.875M15.625 10.625C15.3563 10.6257 15.1172 10.4546 15.0312 10.2M15.625 10.625L15.0312 10.2M18.25 10.125H18.75V9.875H18.25M18.25 10.125V9.875M18.25 10.125L15.625 10.125L15.6237 10.125C15.5705 10.1251 15.523 10.0915 15.5054 10.0414M18.25 9.875H16.075H15.7151L15.6009 9.53374L13.2325 2.45996C13.2325 2.45982 13.2324 2.45968 13.2324 2.45954C13.2157 2.4108 13.171 2.37738 13.1198 2.37504C13.0691 2.37631 13.024 2.40818 13.006 2.45595C13.0059 2.45606 13.0059 2.45617 13.0059 2.45629L7.96853 15.9746L7.52907 17.1539L7.0394 15.9945L4.4894 9.95704L4.48748 9.95251L4.48751 9.9525C4.46842 9.90604 4.42341 9.87555 4.3733 9.875H1.75V10.125H3.95625H4.28936L4.41767 10.4324L7.38642 17.5449L7.3875 17.5475L7.38749 17.5475C7.40663 17.5941 7.45185 17.6246 7.50214 17.625C7.55416 17.625 7.60084 17.5927 7.61914 17.5437L7.61972 17.5422L12.6572 4.19841L13.1586 2.87021L13.6002 4.21949L15.5054 10.0414M15.5054 10.0414L15.5065 10.0445L15.0312 10.2M15.5054 10.0414C15.5053 10.0409 15.5051 10.0404 15.5049 10.04L15.0312 10.2M15.0312 10.2L13.3732 5.13333M15.0312 10.2L13.3732 5.13333M13.3732 5.13333L13.5928 4.5516L13.125 4.375L12.6498 4.53051L12.8432 5.12148L8.0875 17.7187L13.3732 5.13333Z"
                      fill="#3366FF"
                      stroke="#3366FF"
                    ></path>
                  </svg>
                  Activity
                </li>
              </ul>
            </div>
            <div class="tab_body">
              <div class="tab_activity">
                <div class="snft_table">
                  <header
                    class="snft_table__header"
                    style="grid-template-columns: 2fr 1fr 1fr 1fr 40px"
                  >
                    <p class="meta_font">Name</p>
                    <p class="meta_font">Event</p>
                    <p class="meta_font">Price</p>
                    <p class="meta_font">Date</p>
                    <p class="meta_font">Hash</p>
                  </header>

                  <section class="snft_table__body"></section>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="buy__right-con2">
        <h1>More from this artist</h1>
        <div id="buyRightContent" class="buy__right-content"></div>
      </div>
    </div>
  </div>
</section>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const purchaseBtn = document.getElementById("purchaseBtn");
    const purchaseModal = document.getElementById("purchaseModal");
    const cancelPurchase = document.getElementById("cancelPurchase");
    const purchaseForm = document.getElementById("purchaseForm");

    // ✅ Show modal when clicking "Purchase Now"
    purchaseBtn.addEventListener("click", () => {
      console.log("✅ Purchase button clicked!");
      purchaseModal.style.display = "flex"; // Ensure modal is set to visible
    });

    // ✅ Close modal when clicking "Cancel"
    cancelPurchase.addEventListener("click", () => {
      purchaseModal.style.display = "none"; // Hide modal
    });

    // ✅ Close modal when clicking outside of it
    window.addEventListener("click", (event) => {
      if (event.target === purchaseModal) {
        purchaseModal.style.display = "none";
      }
    });

    // ✅ Prevent accidental submission if form action isn't set correctly
    purchaseForm.addEventListener("submit", (event) => {
      const formAction = purchaseForm.getAttribute("action");

      if (!formAction || formAction === "#") {
        event.preventDefault();
        alert("Error: Purchase request cannot be processed. Please try again.");
      }
    });
  });

  document.addEventListener("DOMContentLoaded", () => {
    const container = document.getElementById("buyRightContent");
    container.innerHTML = "<p>Loading NFTs...</p>";

    // ✅ Ensure creator name is fetched correctly
    const creatorElement = document.querySelector(".owner__name");
    const targetCreator = creatorElement ? creatorElement.textContent.trim() : "";

    if (!targetCreator) {
      container.innerHTML = "<p>Creator name not found.</p>";
      return;
    }

    fetch(`/creator/api/nfts/${encodeURIComponent(targetCreator)}`) // ✅ Encode the creator name safely
      .then((response) => {
        if (!response.ok) throw new Error("Failed to fetch NFTs");
        return response.json();
      })
      .then((nfts) => {
        container.innerHTML = "";
        if (nfts.length === 0) {
          container.innerHTML = "<p>No NFTs available at the moment.</p>";
          return;
        }

        nfts.forEach((nft) => {
          const image =  nft.nft_image || "/static/assets/images/default_img.avif";
          const name = nft.nft_name || "Unnamed NFT";
          const creator = nft.creator || "Unknown Creator";
          const price = nft.price ? `${nft.price} ETH` : "N/A";
          const status = nft.status.charAt(0).toUpperCase() + nft.status.slice(1);

          const nftCard = document.createElement("a");
          nftCard.href = `nft_${nft.ref_number}`;
          nftCard.className = "buy__right-content-item";

          nftCard.innerHTML = `
                    <img src="${image}" alt="${name}" class="item__img" />
                    <p class="creator__name">${creator}</p>
                    <h3 class="ttp__name">${name}</h3>
                    <button class="btn flexColCenter">Price<br> ${price}</button>
                `;

          container.appendChild(nftCard);
        });
      })
      .catch((error) => {
        console.error("Error fetching NFTs:", error);
        container.innerHTML =
          "<p>Error loading NFTs. Please try again later.</p>";
      });
  });
</script>
{% endblock %}
